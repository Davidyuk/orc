# DATABASE

![scheme][scheme]

---
Анкета содержит поля, которые объединятся по темам. В системе такие группы полей называются формами. Т.е. анкета мероприятия состоит из тематических форм, которые содержат поля — параметры. Каждый параметр имеет свой тип. Было принято решение рассмотреть несколько типов параметров, которые чаще всего встречаются в регистрационных бланках, а именно: строковое поле, текстовое поле, дата, регион, город, улица, дом.

---
Мероприятия классифицируются по различным наборам признаков, из чего можно полагать, что в анкетах мероприятий одного типа фрагменты полей повторяются. Чтобы упростить процесс создания анкеты, было принято решение связать таблицы мероприятий и типов мероприятий отношением «много ко многим». Такой вид связи позволяет при создании нового мероприятия организовать копирование ранее созданных форм из мероприятия того же типа, что и новое.

---
Форма имеет атрибут «персональная», который характеризует, к какой анкете форма относится: общей для группы или персональной для каждого участника. Таким образом, на одно командное мероприятие приходится максимум две анкеты.

---
Таблица «Физические лица» введена, чтобы обеспечить возможность добавлять в группу участников, неявляющихся пользователями системы.

---
При добавлении в группу участника создается запись в таблице «Участники», в которой атрибут «статус» имеет значение ложь, пока приглашенный участник не подтвердит запрос присоединения к группе (посредством электронной почты). Если участник отклоняет запрос, запись в таблице «Участники» удаляется вовсе.

---
Владелец группы может зарегистрировать группу в мероприятии. Система поддерживает два режима регистрации групп:

*1. Регистрация группы как единое целое в командном мероприятии.* 

Для каждого участника группы проводится индивидуальная регистрация; «заводится» анкета с формами (атрибут «персональная» равен истине), параметры которых имеют пустые значения.

Для владельца группы проводится отдельная регистрация; «заводится» анкета с формами (атрибут «персональная» равен лжи), параметры которых имеют пустые значения. Данная анкета доступна владельцу группы для редактирования. Участники группы могут ее просматривать.

*2. Регистрация группы, подразумевающая индивидуальную регистрацию каждого участника группы.*

Для каждого участника группы проводится индивидуальная регистрация; «заводится» анкета с формами (атрибут «персональная» равен истине), параметры которых имеют пустые значения.

# Сущности

## Мероприятия (events)

Данная сущность предназначена для хранения информации о мероприятиях. Все атрибуты данной таблицы являются обязательными. Для редактирования недоступен атрибут «идентификатор мероприятия». Атрибуты:

- Идентификатор мероприятия. Целое число. Уникальное.
- Название. Текст. Уникальное.
- Дата начала. Дата.
- Дата конца. Дата.
- Время. Время.
- Сайт. Текст.
- Командное. Истина или ложь.

## Типы мероприятий (event_types)

Данная сущность предназначена для хранения информации о типах мероприятий. Все атрибуты данной таблицы являются обязательными. Для редактирования недоступен атрибут «идентификатор типа мероприятия». Атрибуты:

- Идентификатор типа мероприятия. Целое число. Уникальное.
- Название. Текст.
- Описание. Текст.

## Мероприятия — Типы мероприятий (events_types)

Данная сущность предназначена для хранения информации о том, какое мероприятие к какому типу относится (связь «много ко многим»). Все атрибуты данной таблицы являются обязательными. Для редактирования недоступен атрибут «идентификатор записи». Атрибуты:

- Идентификатор записи. Целое число. Уникальное.
- Идентификатор мероприятия. Ссылка на сущность «Мероприятия».
- Идентификатор типа мероприятия. Ссылка на сущность «Типы мероприятий».

## Формы (forms)

Данная сущность предназначена для хранения информации о формах, которые являются составной частью анкеты мероприятия. Все атрибуты данной таблицы являются обязательными. Для редактирования недоступен атрибут «идентификатор формы». Атрибуты:

- Идентификатор формы. Целое число. Уникальное.
- Название формы. Текст. Уникальное.
- Персональная. Истина или ложь. Определяет, составной частью какой анкеты является форма: индивидуальной (персональной) или групповой (общей).

## Мероприятия — Формы (events_forms)

Данная сущность предназначена для хранения информации о том, какая форма анкеты к какому мероприятию относится (связь «много ко многим»). Все атрибуты данной таблицы являются обязательными. Для редактирования недоступен атрибут «идентификатор записи». Атрибуты:

- Идентификатор записи. Целое число. Уникальное.
- Идентификатор мероприятия. Ссылка на сущность «Мероприятия».
- Идентификатор формы. Ссылка на сущность «Формы».

## Типы параметров (param_types)

Данная сущность предназначена для хранения информации о типах параметров, которые определяют примитив графического интерфейса пользователя для отображения параметра в форме. Для редактирования недоступен атрибут «идентификатор типа параметра». Атрибуты:

- Идентификатор типа параметра. Целое число. Уникальное.
- Название формы. Текст.

## Параметры (params)

Данная сущность предназначена для хранения информации о параметрах выше упомянутых форм. Каждый параметр относится к определенной форме (связь «один ко многим»). Все атрибуты данной таблицы являются обязательными. Для редактирования недоступен атрибут «идентификатор параметра». Атрибуты:

- Идентификатор параметра. Целое число. Уникальное.
- Название параметра. Текст. Уникальное.
- Идентификатор типа параметра. Ссылка на сущность «Типы параметров».
- Идентификатор формы. Ссылка на сущность «Формы».
- Обязательность заполнения параметра. Истина или ложь.
- Допустимость редактирования пользователем. Истина или ложь.

Поля, которые пользователь редактировать не может, дают возможность администраторам системы вводить информацию независящую от пользователя. Например, призовое место участника по итогам соревнований, порядковый номер докладчика на семинаре.

## Пользователи (users)

Данная сущность предназначена для хранения информации о пользователях. Все атрибуты данной таблицы являются обязательными. Для редактирования недоступен атрибут «идентификатор пользователя». Атрибуты:

- Идентификатор пользователя. Целое число. Уникальное.
- Логин. Текст. Уникальное.
- Пароль. Текст. Используется для хранения пароля пользователя в виде хэша.
- Соль. Текст. Используется в качестве параметра функции для формирования «пароля».
- Роль. Текст.
- Активность. Истина или ложь. Принимает значение истина, если пользователь подтвердил регистрацию в системе, иначе аккаунт считается неактивным.
- Токен. Текст. Уникальное. Используется для генерации уникальной строки, в свою очередь используемой для подтверждения регистрации пользователя.
- Идентификатор сессии. Текст. Уникальное. Используется для отслеживания состояния сеанса доступа пользователя к системе.

## Физические лица (faces)

Данная сущность предназначена для хранения ссылки на запись в таблице пользователей (связь «один ко многим»). Все атрибуты данной таблицы являются обязательными. Для редактирования недоступен атрибут «идентификатор физического лица». Атрибуты:

- Идентификатор физического лица. Целое число. Уникальное.
- Идентификатор пользователя. Ссылка на сущность «Пользователи».

## Группы (groups)

Данная сущность предназначена для хранения информации о группах. Все атрибуты данной таблицы являются обязательными. Для редактирования недоступен атрибут «идентификатор группы». Атрибуты:

- Идентификатор группы. Целое число. Уникальное.
- Название группы. Текст. Уникальное.
- Владелец группы. Ссылка на сущность «Физические лица».

## Участники (persons)

Данная сущность предназначена для хранения информации о том, к какой группе какое физическое лицо принадлежит (связь «один ко многим»). Все атрибуты данной таблицы являются обязательными. Для редактирования недоступен атрибут «идентификатор участника». Атрибуты:

- Идентификатор участника. Целое число. Уникальное.
- Идентификатор группы. Ссылка на сущность «Группы».
- Идентификатор физического лица. Ссылка на «Физические лица».
- Статус. Истина или ложь.
- Токен. Текст. Уникальное. Используется для формирования уникальной строки, в свою очередь используемой для подтверждения присоединения участника к группе.

## Регистрации (registrations)

Данная сущность предназначена для хранения информации о том, какое физическое лицо для какого мероприятия заполнило анкету. Для редактирования недоступен атрибут «идентификатор регистрации». Редактирование «статуса» доступно только администратору системы. Атрибуты:

- Идентификатор регистрации. Целое число. Уникальное.
- Идентификатор мероприятия. Ссылка на сущность «Мероприятия».
- Идентификатор физического лица. Ссылка на сущность «Физические лица».
- Статус. Истина или ложь.

## Значения параметров (param_values)

Данная сущность предназначена для хранения информации о значениях параметров. Все атрибуты являются обязательными. Для редактирования недоступен атрибут «идентификатор значения параметра». Атрибуты:

- Идентификатор значения параметра. Целое число. Уникальное.
- Идентификатор параметра. Ссылка на сущность «Параметры.
- Значение. Текст.
- Дата последнего редактирования значения параметра. Дата.
- Идентификатор пользователя, редактирующий запись последним. Ссылка на сущность «Пользователи».
- Идентификатор регистрации. Ссылка на сущность «Регистрации».

## Регистрации групп (group_registrations)

Данная сущность предназначена для хранения информации о том, какая группа в каком мероприятии желает принять командное участие. Для редактирования недоступен атрибут «идентификатор регистрации группы». Атрибуты:

- Идентификатор регистрации группы. Целое число. Уникальное.
- Идентификатор мероприятия. Ссылка на сущность «Мероприятия».
- Идентификатор группы. Ссылка на сущность «Группы».
- Статус. Истина или ложь.

## Регистрации - Регистрации групп (regs_groupregs)

Данная сущность предназначена для хранения информации о том, какие индивидуальные регистрации участников были произведены в рамках регистрации группы. Для редактирования недоступен атрибут «идентификатор записи». Атрибуты:

- Идентификатор записи. Целое число. Уникальное.
- Идентификатор регистрации. Ссылка на сущность «Регистрации».
- Идентификатор регистрации группы. Ссылка на сущность «Регистрации группы».

[scheme]: ../docs/img/scheme.png  "database"
